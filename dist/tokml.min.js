!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.tokml=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a,b){return function(c){if(!c.properties||!y.valid(c.geometry))return"";var d=y.any(c.geometry);if(!d)return"";var e="",f="";if(a.simplestyle){var j=s(c.properties);j&&(y.isPoint(c.geometry)&&m(c.properties)?(-1===b.indexOf(j)&&(e=n(c.properties,j),b.push(j)),f=w("styleUrl","#"+j)):(y.isPolygon(c.geometry)||y.isLine(c.geometry))&&q(c.properties)&&(-1===b.indexOf(j)&&(e=r(c.properties,j),b.push(j)),f=w("styleUrl","#"+j)))}return e+w("Placemark",g(c.properties,a)+h(c.properties,a)+k(c.properties)+i(c.properties,a)+d+f)}}function d(a,b){if(!a.type)return"";var d=[];switch(a.type){case"FeatureCollection":return a.features?a.features.map(c(b,d)).join(""):"";case"Feature":return c(b,d)(a);default:return c(b,d)({type:"Feature",geometry:a,properties:{}})}}function e(a){return void 0!==a.documentName?w("name",a.documentName):""}function f(a){return void 0!==a.documentDescription?w("description",a.documentDescription):""}function g(a,b){return a[b.name]?w("name",x(a[b.name])):""}function h(a,b){return a[b.description]?w("description",x(a[b.description])):""}function i(a,b){return a[b.timestamp]?w("TimeStamp",w("when",x(a[b.timestamp]))):""}function j(a){return a.map(function(a){return a.join(",")}).join(" ")}function k(a){return w("ExtendedData",u(a).map(l).join(""))}function l(a){return w("Data",w("value",x(a[1])),[["name",x(a[0])]])}function m(a){return!!(a["marker-size"]||a["marker-symbol"]||a["marker-color"])}function n(a,b){return w("Style",w("IconStyle",w("Icon",w("href",o(a))))+p(a),[["id",b]])}function o(a){var b=a["marker-size"]||"medium",c=a["marker-symbol"]?"-"+a["marker-symbol"]:"",d=(a["marker-color"]||"7e7e7e").replace("#","");return"https://api.tiles.mapbox.com/v3/marker/pin-"+b.charAt(0)+c+"+"+d+".png"}function p(){return w("hotSpot","",[["xunits","fraction"],["yunits","fraction"],["x",.5],["y",.5]])}function q(a){for(var b in a)if({stroke:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,"fill-opacity":!0}[b])return!0}function r(a,b){var c=w("LineStyle",[w("color",t(a.stroke,a["stroke-opacity"])||"ff555555")+w("width",void 0===a["stroke-width"]?2:a["stroke-width"])]),d="";return(a.fill||a["fill-opacity"])&&(d=w("PolyStyle",[w("color",t(a.fill,a["fill-opacity"])||"88555555")])),w("Style",c+d,[["id",b]])}function s(a){var b="";return a["marker-symbol"]&&(b=b+"ms"+a["marker-symbol"]),a["marker-color"]&&(b=b+"mc"+a["marker-color"].replace("#","")),a["marker-size"]&&(b=b+"ms"+a["marker-size"]),a.stroke&&(b=b+"s"+a.stroke.replace("#","")),a["stroke-width"]&&(b=b+"sw"+a["stroke-width"].toString().replace(".","")),a["stroke-opacity"]&&(b=b+"mo"+a["stroke-opacity"].toString().replace(".","")),a.fill&&(b=b+"f"+a.fill.replace("#","")),a["fill-opacity"]&&(b=b+"fo"+a["fill-opacity"].toString().replace(".","")),b}function t(a,b){if("string"!=typeof a)return"";if(a=a.replace("#","").toLowerCase(),3===a.length)a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2];else if(6!==a.length)return"";var c=a[0]+a[1],d=a[2]+a[3],e=a[4]+a[5],f="ff";return"number"==typeof b&&b>=0&&1>=b&&(f=(255*b).toString(16),f.indexOf(".")>-1&&(f=f.substr(0,f.indexOf("."))),f.length<2&&(f="0"+f)),f+e+d+c}function u(a){var b=[];for(var c in a)b.push([c,a[c]]);return b}var v=a("strxml"),w=v.tag,x=v.encode;b.exports=function(a,b){return b=b||{documentName:void 0,documentDescription:void 0,name:"name",description:"description",simplestyle:!1,timestamp:"timestamp"},'<?xml version="1.0" encoding="UTF-8"?>'+w("kml",w("Document",e(b)+f(b)+d(a,b)),[["xmlns","http://www.opengis.net/kml/2.2"]])};var y={Point:function(a){return w("Point",w("coordinates",a.coordinates.join(",")))},LineString:function(a){return w("LineString",w("coordinates",j(a.coordinates)))},Polygon:function(a){if(!a.coordinates.length)return"";var b=a.coordinates[0],c=a.coordinates.slice(1),d=w("outerBoundaryIs",w("LinearRing",w("coordinates",j(b)))),e=c.map(function(a){return w("innerBoundaryIs",w("LinearRing",w("coordinates",j(a))))}).join("");return w("Polygon",d+e)},MultiPoint:function(a){return a.coordinates.length?w("MultiGeometry",a.coordinates.map(function(a){return y.Point({coordinates:a})}).join("")):""},MultiPolygon:function(a){return a.coordinates.length?w("MultiGeometry",a.coordinates.map(function(a){return y.Polygon({coordinates:a})}).join("")):""},MultiLineString:function(a){return a.coordinates.length?w("MultiGeometry",a.coordinates.map(function(a){return y.LineString({coordinates:a})}).join("")):""},GeometryCollection:function(a){return w("MultiGeometry",a.geometries.map(y.any).join(""))},valid:function(a){return a&&a.type&&(a.coordinates||"GeometryCollection"===a.type&&a.geometries&&a.geometries.every(y.valid))},any:function(a){return y[a.type]?y[a.type](a):""},isPoint:function(a){return"Point"===a.type||"MultiPoint"===a.type},isPolygon:function(a){return"Polygon"===a.type||"MultiPolygon"===a.type},isLine:function(a){return"LineString"===a.type||"MultiLineString"===a.type}}},{strxml:2}],2:[function(a,b){function c(a){return a&&a.length?" "+a.map(function(a){return a[0]+'="'+a[1]+'"'}).join(" "):""}function d(a,b){return"<"+a+c(b)+"/>"}function e(a,b,d){return"<"+a+c(d)+">"+b+"</"+a+">"}function f(a){return(null===a?"":a.toString()).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}b.exports.attr=c,b.exports.tagClose=d,b.exports.tag=e,b.exports.encode=f},{}]},{},[1])(1)});