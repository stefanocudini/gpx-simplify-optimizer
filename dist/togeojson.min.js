var toGeoJSON=function(){"use strict";function a(a){if(!a||!a.length)return 0;for(var b=0,c=0;b<a.length;b++)c=(c<<5)-c+a.charCodeAt(b)|0;return c}function b(a,b){return a.getElementsByTagName(b)}function c(a,b){return a.getAttribute(b)}function d(a,b){return parseFloat(c(a,b))}function e(a,c){var d=b(a,c);return d.length?d[0]:null}function f(a){return a.normalize&&a.normalize(),a}function g(a){for(var b=0,c=[];b<a.length;b++)c[b]=parseFloat(a[b]);return c}function h(a){return a&&f(a),a&&a.textContent||""}function i(a,b){var c,d,f={};for(d=0;d<b.length;d++)c=e(a,b[d]),c&&(f[b[d]]=h(c));return f}function j(a,b){for(var c in b)a[c]=b[c]}function k(a){return g(a.replace(q,"").split(","))}function l(a){for(var b=a.replace(r,"").split(s),c=[],d=0;d<b.length;d++)c.push(k(b[d]));return c}function m(a){var b,c=[d(a,"lon"),d(a,"lat")],f=e(a,"ele"),g=e(a,"gpxtpx:hr")||e(a,"hr"),i=e(a,"time");return f&&(b=parseFloat(h(f)),isNaN(b)||c.push(b)),{coordinates:c,time:i?h(i):null,heartRate:g?parseFloat(h(g)):null}}function n(){return{type:"FeatureCollection",features:[]}}function o(a){return void 0!==a.xml?a.xml:p.serializeToString(a)}var p,q=/\s*/g,r=/^\s*|\s*$/g,s=/\s+/;if("undefined"!=typeof XMLSerializer)p=new XMLSerializer;else{var t="object"==typeof process&&!process.browser,u="object"==typeof Titanium;if("object"!=typeof exports||!t&&!u)throw new Error("Unable to initialize serializer");p=new(require("xmldom").XMLSerializer)}var v={kml:function(d){function f(a){var b,c;return a=a||"","#"===a.substr(0,1)&&(a=a.substr(1)),(6===a.length||3===a.length)&&(b=a),8===a.length&&(c=parseInt(a.substr(0,2),16)/255,b="#"+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)),[b,isNaN(c)?void 0:c]}function i(a){return g(a.split(" "))}function j(a){var c=b(a,"coord","gx"),d=[],e=[];0===c.length&&(c=b(a,"gx:coord"));for(var f=0;f<c.length;f++)d.push(i(h(c[f])));for(var g=b(a,"when"),j=0;j<g.length;j++)e.push(h(g[j]));return{coords:d,times:e}}function m(a){var c,d,f,g,i,n=[],o=[];if(e(a,"MultiGeometry"))return m(e(a,"MultiGeometry"));if(e(a,"MultiTrack"))return m(e(a,"MultiTrack"));if(e(a,"gx:MultiTrack"))return m(e(a,"gx:MultiTrack"));for(f=0;f<u.length;f++)if(d=b(a,u[f]))for(g=0;g<d.length;g++)if(c=d[g],"Point"===u[f])n.push({type:"Point",coordinates:k(h(e(c,"coordinates")))});else if("LineString"===u[f])n.push({type:"LineString",coordinates:l(h(e(c,"coordinates")))});else if("Polygon"===u[f]){var p=b(c,"LinearRing"),q=[];for(i=0;i<p.length;i++)q.push(l(h(e(p[i],"coordinates"))));n.push({type:"Polygon",coordinates:q})}else if("Track"===u[f]||"gx:Track"===u[f]){var r=j(c);n.push({type:"LineString",coordinates:r.coords}),r.times.length&&o.push(r.times)}return{geoms:n,coordTimes:o}}function p(a){var d,g=m(a),i={},j=h(e(a,"name")),k=h(e(a,"address")),l=h(e(a,"styleUrl")),n=h(e(a,"description")),o=e(a,"TimeSpan"),p=e(a,"TimeStamp"),q=e(a,"ExtendedData"),u=e(a,"LineStyle"),v=e(a,"PolyStyle"),w=e(a,"visibility");if(!g.geoms.length)return[];if(j&&(i.name=j),k&&(i.address=k),l){"#"!==l[0]&&(l="#"+l),i.styleUrl=l,r[l]&&(i.styleHash=r[l]),t[l]&&(i.styleMapHash=t[l],i.styleHash=r[t[l].normal]);var x=s[i.styleHash];if(x){u||(u=e(x,"LineStyle")),v||(v=e(x,"PolyStyle"));var y=e(x,"IconStyle");if(y){var z=e(y,"Icon");if(z){var A=h(e(z,"href"));A&&(i.icon=A)}}}}if(n&&(i.description=n),o){var B=h(e(o,"begin")),C=h(e(o,"end"));i.timespan={begin:B,end:C}}if(p&&(i.timestamp=h(e(p,"when"))),u){var D=f(h(e(u,"color"))),E=D[0],F=D[1],G=parseFloat(h(e(u,"width")));E&&(i.stroke=E),isNaN(F)||(i["stroke-opacity"]=F),isNaN(G)||(i["stroke-width"]=G)}if(v){var H=f(h(e(v,"color"))),I=H[0],J=H[1],K=h(e(v,"fill")),L=h(e(v,"outline"));I&&(i.fill=I),isNaN(J)||(i["fill-opacity"]=J),K&&(i["fill-opacity"]="1"===K?i["fill-opacity"]||1:0),L&&(i["stroke-opacity"]="1"===L?i["stroke-opacity"]||1:0)}if(q){var M=b(q,"Data"),N=b(q,"SimpleData");for(d=0;d<M.length;d++)i[M[d].getAttribute("name")]=h(e(M[d],"value"));for(d=0;d<N.length;d++)i[N[d].getAttribute("name")]=h(N[d])}w&&(i.visibility=h(w)),g.coordTimes.length&&(i.coordTimes=1===g.coordTimes.length?g.coordTimes[0]:g.coordTimes);var O={type:"Feature",geometry:1===g.geoms.length?g.geoms[0]:{type:"GeometryCollection",geometries:g.geoms},properties:i};return c(a,"id")&&(O.id=c(a,"id")),[O]}for(var q=n(),r={},s={},t={},u=["Polygon","LineString","Point","Track","gx:Track"],v=b(d,"Placemark"),w=b(d,"Style"),x=b(d,"StyleMap"),y=0;y<w.length;y++){var z=a(o(w[y])).toString(16);r["#"+c(w[y],"id")]=z,s[z]=w[y]}for(var A=0;A<x.length;A++){r["#"+c(x[A],"id")]=a(o(x[A])).toString(16);for(var B=b(x[A],"Pair"),C={},D=0;D<B.length;D++)C[h(e(B[D],"key"))]=h(e(B[D],"styleUrl"));t["#"+c(x[A],"id")]=C}for(var E=0;E<v.length;E++)q.features=q.features.concat(p(v[E]));return q},gpx:function(a){function d(a,b){for(var c=0;b>c;c++)a.push(null);return a}function f(a,c){var e=b(a,c),f=[],g=[],h=[],i=e.length;if(2>i)return{};for(var j=0;i>j;j++){var k=m(e[j]);f.push(k.coordinates),k.time&&g.push(k.time),(k.heartRate||h.length)&&(h.length||d(h,j),h.push(k.heartRate||null))}return{line:f,times:g,heartRates:h}}function g(a){for(var c,g=b(a,"trkseg"),h=[],i=[],k=[],l=0;l<g.length;l++)if(c=f(g[l],"trkpt"),c&&(c.line&&h.push(c.line),c.times&&c.times.length&&i.push(c.times),k.length||c.heartRates&&c.heartRates.length)){if(!k.length)for(var m=0;l>m;m++)k.push(d([],h[m].length));k.push(c.heartRates&&c.heartRates.length?c.heartRates:d([],c.line.length||0))}if(0!==h.length){var n=p(a);return j(n,o(e(a,"extensions"))),i.length&&(n.coordTimes=1===h.length?i[0]:i),k.length&&(n.heartRates=1===h.length?k[0]:k),{type:"Feature",properties:n,geometry:{type:1===h.length?"LineString":"MultiLineString",coordinates:1===h.length?h[0]:h}}}}function k(a){var b=f(a,"rtept");if(b.line){var c=p(a);j(c,o(e(a,"extensions")));var d={type:"Feature",properties:c,geometry:{type:"LineString",coordinates:b.line}};return d}}function l(a){var b=p(a);return j(b,i(a,["sym"])),{type:"Feature",properties:b,geometry:{type:"Point",coordinates:m(a).coordinates}}}function o(a){var b={};if(a){var c=e(a,"line");if(c){var d=h(e(c,"color")),f=parseFloat(h(e(c,"opacity"))),g=parseFloat(h(e(c,"width")));d&&(b.stroke=d),isNaN(f)||(b["stroke-opacity"]=f),isNaN(g)||(b["stroke-width"]=96*g/25.4)}}return b}function p(a){var d=i(a,["name","cmt","desc","type","time","keywords"]),e=b(a,"link");e.length&&(d.links=[]);for(var f,g=0;g<e.length;g++)f={href:c(e[g],"href")},j(f,i(e[g],["text","type"])),d.links.push(f);return d}var q,r,s=b(a,"trk"),t=b(a,"rte"),u=b(a,"wpt"),v=n();for(q=0;q<s.length;q++)r=g(s[q]),r&&v.features.push(r);for(q=0;q<t.length;q++)r=k(t[q]),r&&v.features.push(r);for(q=0;q<u.length;q++)v.features.push(l(u[q]));return v}};return v}();"undefined"!=typeof module&&(module.exports=toGeoJSON);